{% extends 'layout.html' %}
{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}
{% block content %}
  <div class="container mx-auto mt-2">
    <h1 class="font-bold text-2xl">Dashboard</h1>
    
    <div class="mt-6">
      <h2 class="font-semibold text-xl mb-4">Matriz de Ações por Eixo e Nível</h2>
      
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-300">
          <thead>
            <tr>
              <th class="py-2 px-4 border-b border-r">Níveis / Eixos</th>
              {% for axis in axes %}
                <th class="py-2 px-4 border-b border-r">{{ axis.name }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for row in matrix %}
              <tr>
                <td class="py-2 px-4 border-b border-r font-medium">{{ row.level.name }}</td>
                {% for cell in row.cells %}
                  <td class="py-2 px-4 border-b border-r text-center">
                    <span class="inline-block bg-blue-100 text-blue-800 font-semibold px-3 py-1 rounded-full">
                      {{ cell.count }}
                    </span>
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      
      <div class="mt-6">
        <p class="text-sm text-gray-600">
          * Os números representam a quantidade de ações adicionadas em cada par eixo-nível.
        </p>
      </div>
    </div>
  </div>

  <div id="graficos" class="w-1/2 mx-auto"></div>

  <script>

    // O editor aponta erro, mas o django deixa passar dados assim.
    const data = {{ level_axis_actions|safe }};

    for(let level in data) {
      let axes = data[level]['axes'];
      let actions = data[level]['actions'];

      const containerGraficos = document.getElementById('graficos');
      const canvasGrafico = document.createElement('canvas');
      canvasGrafico.setAttribute('id', `grafico-${level}`);
      containerGraficos.appendChild(canvasGrafico);

      const ctx = document.getElementById(canvasGrafico.id);

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: axes,
          datasets: [{
            label: level,
            data: actions,
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          },
          indexAxis: 'y',
          elements: {
            bar: {
            }
          },
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: `Ações por eixo no nível ${level}`
            }
          }
        }
      });
    }


  </script>
{% endblock %}
