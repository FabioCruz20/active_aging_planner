{% extends 'layout.html' %}
{% load heroicons %}
{% block javascript %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}
{% block content %}
  <div class="container mx-auto px-4 lg:px-6 mt-4">
    <div class="flex items-center mb-6">
      {% heroicon_solid "chart-bar" class="w-8 h-8 text-indigo-600 mr-3" %}
      <h1 class="font-bold text-3xl text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600">Dashboard</h1>
    </div>
    
    <div class="mt-6">
      <div class="rounded-2xl overflow-hidden shadow-sm border border-gray-200">
        <div class="flex items-center justify-between bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-5 py-4">
          <div class="flex items-center">
            {% heroicon_solid "table-cells" class="w-6 h-6 mr-2 opacity-90" %}
            <h2 class="font-semibold text-lg">Ações por eixo temático</h2>
          </div>
          <span class="text-sm opacity-80">Contagem por eixo e nível</span>
        </div>

        <div class="overflow-x-auto bg-white">
          <table class="min-w-full text-sm">
            <thead class="bg-gray-50">
              <tr>
                {% for axis in axes %}
                  <th class="py-3 px-4 text-gray-700 font-semibold border-b">{{ axis.name }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody class="bg-white">
              {% for row in matrix %}
                <tr class="hover:bg-indigo-50/40">
                  {% for cell in row.cells %}
                    <td class="py-3 px-4 border-b text-center">
                      {% if cell.count == 0 %}
                        <span class="inline-flex items-center justify-center px-3 py-1 rounded-full bg-gray-100 text-gray-700 font-semibold">{{ cell.count }}</span>
                      {% elif cell.count < 3 %}
                        <span class="inline-flex items-center justify-center px-3 py-1 rounded-full bg-indigo-100 text-indigo-800 font-semibold">{{ cell.count }}</span>
                      {% else %}
                        <span class="inline-flex items-center justify-center px-3 py-1 rounded-full bg-purple-100 text-purple-800 font-semibold">{{ cell.count }}</span>
                      {% endif %}
                    </td>
                  {% endfor %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="px-5 py-3 bg-white">
          <p class="text-sm text-gray-600">
            * Os números representam a quantidade de ações adicionadas em cada par eixo-nível.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div id="graficos" class="w-1/2 mx-auto py-8"></div>

  <script>

    // O editor aponta erro, mas o django deixa passar dados assim.
    const data = {{ level_axis_actions|safe }};

    for(let level in data) {
      let axes = data[level]['axes'];
      let actions = data[level]['actions'];

      const containerGraficos = document.getElementById('graficos');
      const canvasGrafico = document.createElement('canvas');
      canvasGrafico.setAttribute('id', `grafico-${level}`);
      containerGraficos.appendChild(canvasGrafico);

      const ctx = document.getElementById(canvasGrafico.id);

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: axes,
          datasets: [{
            label: level,
            data: actions,
            borderWidth: 1
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          },
          indexAxis: 'y',
          elements: {
            bar: {
            }
          },
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: `Ações em adicionadas em cada eixo temático`
            }
          }
        }
      });
    }

  </script>
{% endblock %}
