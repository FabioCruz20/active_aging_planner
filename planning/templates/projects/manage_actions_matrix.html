{% extends 'layout.html' %}

{% block content %}
<div class="container px-4 mx-auto">
    <div class="mt-2 mb-4">
        <h1 class="font-bold text-2xl">Ações nos eixos temáticos</h1>
    </div>

    <div class="mb-6">
        {% csrf_token %}
        
        <div class="overflow-x-auto">
            <table class="w-full border-collapse border border-gray-300">
                <thead>
                    <tr class="bg-gray-100">
                        <th class="border border-gray-300 p-3 text-left font-semibold w-1/3">Eixo Temático / Nível</th>
                        {% for level in levels %}
                        <th class="border border-gray-300 p-3 text-center font-semibold">
                            Ações
                        </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for axis, level_data in matrix.items %}
                    <tr class="{% cycle 'bg-white' 'bg-gray-50' %}">
                        <td class="border border-gray-300 p-3 font-medium bg-gray-100">
                            {{ axis.name }}
                        </td>
                        {% for level in levels %}
                        <td class="border border-gray-300 p-3 text-center">
                            {% for level_key, cell_data in level_data.items %}
                                {% if level_key == level %}
                                    <!-- Link para gerenciar ações -->
                                    <div class="flex items-center">
                                        <a href="{% url 'projects:manage_axis_level_actions' axis.id level.id %}" 
                                           class="inline-block px-3 py-2 bg-indigo-500 text-white text-sm rounded hover:bg-indigo-700 transition-colors">
                                            <i class="fas fa-cog"></i> Gerenciar Ações
                                        </a>
                                        <div class="text-sm text-gray-600 flex-1">
                                            {{ cell_data.actions.count }} 
                                            {% if cell_data.actions.count == 1 %} 
                                                ação
                                            {% else %} 
                                                ações
                                            {% endif %}
                                            no total
                                        </div>
                                        
                                        <div class="text-sm text-gray-600 flex-1">
                                            {{ cell_data.completed_actions }} completas
                                        </div>

                                        <div class="text-sm text-gray-600 flex-1">
                                            {{ cell_data.total_actions }} adicionadas
                                        </div>

                                        <div class="text-sm text-gray-600 flex-2">
                                            <span class="font-medium">Progresso</span>:
                                            {{ cell_data.progress|floatformat:1 }}%
                                            <span class="text-xs">({{ cell_data.completed_actions }}/{{ cell_data.total_actions }} ações completas)</span>
                                        </div>
                                    </div>

                                {% endif %}
                            {% empty %}
                                <!-- Link para gerenciar ações quando não há dados -->
                                <div class="mb-3">
                                    <a href="{% url 'projects:manage_axis_level_actions' axis.id level.id %}" 
                                       class="inline-block px-3 py-2 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors">
                                        <i class="fas fa-cog"></i> Gerenciar Ações
                                    </a>
                                    <div class="mt-1 text-xs text-gray-600">
                                        0 ações
                                    </div>
                                </div>
                                
                                <div class="mt-2">
                                    <div class="text-sm">
                                        <div class="font-medium">Progresso:</div>
                                        <div class="text-gray-600">
                                            0%
                                            <span class="text-xs">(0/0 ações completas)</span>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="mt-4">

        </div>
    </div>

    <div class="mt-6 p-4 bg-blue-50 rounded">
        <h3 class="font-semibold mb-2">Como usar esta matriz:</h3>
        <ul class="text-sm text-gray-700 space-y-1">
            <li>• Cada célula exibe dados sobre as ações no eixo temático</li>
            <li>• Clique em "Gerenciar Ações" para adicionar, editar ou remover ações no eixo</li>
            <li>• O número de ações é exibido abaixo do botão de gerenciamento</li>
            <li>• O progresso é calculado automaticamente com base nas ações que têm todas as suas tarefas concluídas</li>
            <li>• Para aumentar o progresso, complete todas as tarefas de cada ação</li>
        </ul>
    </div>
</div>
{% endblock %}